# 01.1 - è¨­å®š root å¸³è™Ÿ 

å› ç‚ºæ˜¯ç¬¬äºŒå¤©çš„äº‹äº†ï¼Œæ‰€ä»¥å…ˆé‡å•Ÿ container ç„¶å¾Œé€²åˆ° container shell è£¡é¢ã€‚

```docker
docker ps -ls
CONTAINER ID   IMAGE              COMMAND             CREATED      STATUS                    PORTS                                   NAMES     SIZE
5a39024e6d4b   gitlab/gitlab-ee   "/assets/wrapper"   7 days ago   Exited (255) 4 days ago   22/tcp, 443/tcp, 0.0.0.0:8080->80/tcp   gitlab    2.8MB (virtual 2.78GB)
```

```docker
docker restart 5a390
5a390
```

```docker
docker ps
CONTAINER ID   IMAGE              COMMAND             CREATED      STATUS                            PORTS                                   NAMES
5a39024e6d4b   gitlab/gitlab-ee   "/assets/wrapper"   7 days ago   Up 4 seconds (health: starting)   22/tcp, 443/tcp, 0.0.0.0:8080->80/tcp   gitlab
```

```docker
docker exec -it 5a390 sh 
```

åŸ·è¡Œ `gitlab-ctl reconfigure` å¾Œæœƒè·‘å‡ºå¾ˆå¤šæ±è¥¿ã€‚
> Q. é€™å€‹æ­¥é©Ÿè¦å¹¹å˜›@@?
```shell
$ gitlab-ctl reconfigure
ffi-libarchive could not be loaded, libarchive is probably not installed on system, archive_file will not be available
[2022-07-21T17:00:39+00:00] INFO: Started Chef Infra Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)
Chef Infra Client, version 17.10.0
Patents: https://www.chef.io/patents
Infra Phase starting
[2022-07-21T17:00:39+00:00] INFO: *** Chef Infra Client 17.10.0 ***
[2022-07-21T17:00:39+00:00] INFO: Platform: x86_64-linux
[2022-07-21T17:00:39+00:00] INFO: Chef-client pid: 4236
[2022-07-21T17:00:40+00:00] INFO: Setting the run_list to ["recipe[gitlab-ee]"] from CLI options
[2022-07-21T17:00:40+00:00] INFO: Run List is [recipe[gitlab-ee]]
[2022-07-21T17:00:40+00:00] INFO: Run List expands to [gitlab-ee]
[2022-07-21T17:00:40+00:00] INFO: Starting Chef Infra Client Run for 5a39024e6d4b
[2022-07-21T17:00:40+00:00] INFO: Running start handlers
[2022-07-21T17:00:40+00:00] INFO: Start handlers complete.
Resolving cookbooks for run list: ["gitlab-ee"]
[2022-07-21T17:00:41+00:00] INFO: Loading cookbooks [gitlab-ee@0.0.1, package@0.1.0, gitlab@0.0.1, consul@0.1.0, patroni@0.1.0, pgbouncer@0.1.0, spamcheck@0.1.0, runit@5.1.3, logrotate@0.1.0, postgresql@0.1.0, redis@0.1.0, monitoring@0.1.0, registry@0.1.0, mattermost@0.1.0, gitaly@0.1.0, praefect@0.1.0, gitlab-kas@0.1.0, gitlab-pages@0.1.0, letsencrypt@0.1.0, nginx@0.1.0, acme@4.1.5, crond@0.1.0]
Synchronizing cookbooks:
  - gitlab-ee (0.0.1)
  - package (0.1.0)
  - gitlab (0.0.1)
  - consul (0.1.0)
  - patroni (0.1.0)
  - pgbouncer (0.1.0)
  - spamcheck (0.1.0)
  - runit (5.1.3)
  - logrotate (0.1.0)
  - postgresql (0.1.0)
  - redis (0.1.0)
  - monitoring (0.1.0)
  - registry (0.1.0)
  - mattermost (0.1.0)
  - gitaly (0.1.0)
  - praefect (0.1.0)
  - gitlab-kas (0.1.0)
  - gitlab-pages (0.1.0)
  - letsencrypt (0.1.0)
  - nginx (0.1.0)
  - crond (0.1.0)
  - acme (4.1.5)
Installing cookbook gem dependencies:
```

ä¸­é–“æœ‰ä¸€æ®µè·‘å‡ºé€™äº›ï¼š

![](/images/gitlab/1.1-1.png)

## ä½†æ˜¯æˆ‘é‚„æ˜¯æ²’è¾¦æ³•è¨­å®š root!!! ä¹‹è§£æ³•
ç¸½ä¹‹å•Ÿå‹• `http://localhost:8080` å¾Œæ‡‰è©²è¦é¦¬ä¸Šæ›´æ”¹ `root` çš„å¸³è™Ÿå¯†ç¢¼ã€‚GitLab æœ¬èº«æœ‰ä¸€çµ„é è¨­çš„å¸³è™Ÿå¯†ç¢¼ï¼š

```
å¸³è™Ÿï¼šroot
å¯†ç¢¼ï¼š5iveL!fe
```

ä½†æ˜¯...
**Invalid login or password.**

![](/images/gitlab/1.1-2.png)

å®˜ç¶²ä¸Šå¯«æœ‰æä¾› Rake Task è®“ä½¿ç”¨è€…å» reset å¯†ç¢¼ã€‚
#### Rake Task
æœ‰å…©ç¨®æ–¹å¼å¯ä»¥åŸ·è¡Œ Rake Taskï¼š
1. **`gitlab-rake <raketask>` for [Omnibus GitLab](https://docs.gitlab.com/omnibus/index.html) installations.**

    ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å°±å¯ä»¥é‡æ–°è¨­å®šæŸå€‹æŒ‡å®šå¸³è™Ÿçš„å¯†ç¢¼ã€‚
    ```linux
    sudo gitlab-rake "gitlab:password:reset"
    ```

    åœ¨æä¾› `username`ã€`password` ä»¥åŠ `password confirmation` ä¹‹å¾Œï¼ŒGitLab å°±æœƒæ›´æ–°æŒ‡å®šå¸³è™Ÿçš„å¯†ç¢¼ã€‚

    Rake Task ä¹Ÿå¯ä»¥æŠŠ `username` ç•¶ä½œåƒæ•¸ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š
    ```linux
    sudo gitlab-rake "gitlab:password:reset[johndoe]"
    ```

    ğŸ’¡ è¦ä¿®æ”¹é è¨­çš„ `root` å¯†ç¢¼ä¹Ÿå¯ä»¥ä½¿ç”¨é€™å€‹æŒ‡ä»¤ï¼Œå°‡ `root` ç•¶ä½œæ˜¯ `username` åƒæ•¸å¸¶å…¥å³å¯ã€‚
<br/>

2. **`bundle exec rake <raketask>` for [source](https://docs.gitlab.com/ee/install/installation.html) installations.**
    å¾å…¶ä»– source ä¸‹è¼‰å®‰è£çš„ GitLab å°±æ¯”è¼ƒéº»ç…©äº†ï¼Œè¦é€²åˆ°æŒ‡å®šçš„è³‡æ–™å¤¾åŸ·è¡ŒæŒ‡ä»¤ã€‚
    ```docker
    cd /home/git/gitlab

    # è®Šæ›æˆ git ä½¿ç”¨è€…ä¸¦åˆå§‹åŒ–è³‡æ–™åº«
    sudo -u git -H bundle exec rake -vT RAILS_ENV=production
    ```

![](/images/gitlab/1.1-3.png)


åƒè€ƒç¶²ç«™ï¼š
1. å®˜ç¶² [How to reset user password](https://microfluidics.utoronto.ca/gitlab/help/security/reset_user_password.md)
2. å®˜ç¶² [Rake Task](https://docs.gitlab.com/ee/raketasks/)
3. [Medium - Gitlab é è¨­å¸³è™Ÿå¯†ç¢¼](https://medium.com/hsu-keyman/gitlab-%E9%A0%90%E8%A8%AD%E5%B8%B3%E8%99%9F%E5%AF%86%E7%A2%BC-5a7ead4af140)

## åƒè€ƒ
* https://xenby.com/b/131-%E6%8E%A8%E8%96%A6-gitlab%E5%AE%89%E8%A3%9D%E8%88%87%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A%E6%95%99%E5%AD%B8